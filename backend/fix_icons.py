import os
import django

os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'config.settings')
django.setup()

from master.models import IngredientMaster

# ì¹´í…Œê³ ë¦¬ ë° ì´ë¦„ ê¸°ë°˜ ì´ëª¨ì§€ ë§¤í•‘
emoji_map = {
    # ì±„ì†Œ
    'ê¹€ì¹˜': 'ðŸ¥¬', 'ë°°ì¶”': 'ðŸ¥¬', 'ì–‘ë°°ì¶”': 'ðŸ¥¬', 'ì‹œê¸ˆì¹˜': 'ðŸ¥¬', 'ê¹»ìžŽ': 'ðŸ¥¬',
    'ë‹¹ê·¼': 'ðŸ¥•', 'ë¬´': 'ðŸ¥•', 'ê°ìž': 'ðŸ¥”', 'ê³ êµ¬ë§ˆ': 'ðŸ ',
    'ì–‘íŒŒ': 'ðŸ§…', 'íŒŒ': 'ðŸ§…', 'ëŒ€íŒŒ': 'ðŸ§…', 'ìª½íŒŒ': 'ðŸ§…',
    'ë§ˆëŠ˜': 'ðŸ§„', 'ìƒê°•': 'ðŸ¥¬', 'ê³ ì¶”': 'ðŸŒ¶ï¸', 'í”¼ë§': 'ðŸ«‘', 'íŒŒí”„ë¦¬ì¹´': 'ðŸ«‘',
    'ë²„ì„¯': 'ðŸ„', 'í˜¸ë°•': 'ðŸ¥’', 'ì˜¤ì´': 'ðŸ¥’', 'ê°€ì§€': 'ðŸ†',
    'ë¸Œë¡œì½œë¦¬': 'ðŸ¥¦', 'ì½©ë‚˜ë¬¼': 'ðŸŒ±', 'ìˆ™ì£¼': 'ðŸŒ±', 'ìƒì¶”': 'ðŸ¥¬',
    'í† ë§ˆí† ': 'ðŸ…', 'ì˜¥ìˆ˜ìˆ˜': 'ðŸŒ½',
    
    # ê³¼ì¼
    'ì‚¬ê³¼': 'ðŸŽ', 'ë°°': 'ðŸ', 'ë°”ë‚˜ë‚˜': 'ðŸŒ', 'í¬ë„': 'ðŸ‡',
    'ë”¸ê¸°': 'ðŸ“', 'ê·¤': 'ðŸŠ', 'ì˜¤ë Œì§€': 'ðŸŠ', 'ë ˆëª¬': 'ðŸ‹',
    'ìˆ˜ë°•': 'ðŸ‰', 'ì°¸ì™¸': 'ðŸˆ', 'ë©œë¡ ': 'ðŸˆ', 'ë³µìˆ­ì•„': 'ðŸ‘',
    'ìžë‘': 'ðŸ‘', 'ë§ê³ ': 'ðŸ¥­', 'í‚¤ìœ„': 'ðŸ¥', 'ë¸”ë£¨ë² ë¦¬': 'ðŸ«',
    'ì²´ë¦¬': 'ðŸ’', 'ì•„ë³´ì¹´ë„': 'ðŸ¥‘',
    
    # ìœ¡ë¥˜
    'ê³ ê¸°': 'ðŸ¥©', 'ì†Œê³ ê¸°': 'ðŸ¥©', 'ë¼ì§€ê³ ê¸°': 'ðŸ¥©', 'ì‚¼ê²¹ì‚´': 'ðŸ¥“',
    'ë‹­ê³ ê¸°': 'ðŸ—', 'ë‹­': 'ðŸ—', 'ì˜¤ë¦¬': 'ðŸ¦†', 'ë² ì´ì»¨': 'ðŸ¥“',
    'í–„': 'ðŸ–', 'ì†Œì‹œì§€': 'ðŸŒ­',
    
    # ìˆ˜ì‚°ë¬¼
    'ìƒì„ ': 'ðŸŸ', 'ê³ ë“±ì–´': 'ðŸŸ', 'ì—°ì–´': 'ðŸŸ', 'ì°¸ì¹˜': 'ðŸŸ', 'ê°ˆì¹˜': 'ðŸŸ',
    'ìƒˆìš°': 'ðŸ¦', 'ê²Œ': 'ðŸ¦€', 'ì˜¤ì§•ì–´': 'ðŸ¦‘', 'ë¬¸ì–´': 'ðŸ™',
    'ì¡°ê°œ': 'ðŸ¦ª', 'êµ´': 'ðŸ¦ª', 'í™í•©': 'ðŸ¦ª', 'ë¯¸ì—­': 'ðŸ¥¬', 'ê¹€': 'ðŸ¥¬',
    
    # ìœ ì œí’ˆ
    'ìš°ìœ ': 'ðŸ¥›', 'ì¹˜ì¦ˆ': 'ðŸ§€', 'ë²„í„°': 'ðŸ§ˆ', 'ìš”ê±°íŠ¸': 'ðŸ¥›', 'ìš”êµ¬ë¥´íŠ¸': 'ðŸ¥›',
    'ë‹¬ê±€': 'ðŸ¥š', 'ê³„ëž€': 'ðŸ¥š',
    
    # ê³¡ë¥˜/ë©´
    'ìŒ€': 'ðŸš', 'ë°¥': 'ðŸš', 'ë¹µ': 'ðŸž', 'ë–¡': 'ðŸ¡', 'ë©´': 'ðŸœ', 'êµ­ìˆ˜': 'ðŸœ',
    'ë¼ë©´': 'ðŸœ', 'íŒŒìŠ¤íƒ€': 'ðŸ', 'ë§Œë‘': 'ðŸ¥Ÿ',
    
    # ìŒë£Œ
    'ë¬¼': 'ðŸ’§', 'ì°¨': 'ðŸµ', 'ì»¤í”¼': 'â˜•', 'ì£¼ìŠ¤': 'ðŸ§ƒ', 'ì½œë¼': 'ðŸ¥¤', 'ì‚¬ì´ë‹¤': 'ðŸ¥¤',
    
    # ì¡°ë¯¸ë£Œ/ì–‘ë…
    'ì†Œê¸ˆ': 'ðŸ§‚', 'ì„¤íƒ•': 'ðŸ¬', 'ê°„ìž¥': 'ðŸ«™', 'ëœìž¥': 'ðŸ«™', 'ê³ ì¶”ìž¥': 'ðŸ«™',
    'ì‹ì´ˆ': 'ðŸ«™', 'ê¸°ë¦„': 'ðŸ«’', 'ì˜¬ë¦¬ë¸Œìœ ': 'ðŸ«’', 'ì°¸ê¸°ë¦„': 'ðŸ«’',
    'ê¿€': 'ðŸ¯', 'ìž¼': 'ðŸ¯',
}

def update_icons():
    updated = 0
    masters = IngredientMaster.objects.filter(icon='ðŸ“¦') | IngredientMaster.objects.filter(icon__isnull=True) | IngredientMaster.objects.filter(icon='')
    
    for m in masters:
        new_icon = None
        # 1. ì •í™•í•œ ì´ë¦„ ë§¤ì¹­
        for keyword, icon in emoji_map.items():
            if keyword in m.name:
                new_icon = icon
                break
        
        # 2. ì¹´í…Œê³ ë¦¬ ê¸°ë°˜ ê¸°ë³¸ê°’
        if not new_icon:
            category_defaults = {
                'ì±„ì†Œ': 'ðŸ¥¬', 'ê³¼ì¼': 'ðŸŽ', 'ìœ¡ë¥˜': 'ðŸ¥©', 'ìˆ˜ì‚°ë¬¼': 'ðŸŸ',
                'ìœ ì œí’ˆ': 'ðŸ¥›', 'ê°€ê³µì‹í’ˆ': 'ðŸ¥«', 'ìŒë£Œ': 'ðŸ§ƒ', 'ê³¡ë¥˜': 'ðŸŒ¾',
            }
            new_icon = category_defaults.get(m.category, 'ðŸ“¦')
        
        if new_icon and new_icon != m.icon:
            print(f"Updating '{m.name}' ({m.category}): {m.icon} -> {new_icon}")
            m.icon = new_icon
            m.save()
            updated += 1
    
    print(f"\nDone! Updated {updated} items.")

if __name__ == "__main__":
    update_icons()
